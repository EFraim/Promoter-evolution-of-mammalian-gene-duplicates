from pandas import *
from scipy.stats import chisquare
from scipy.stats import mannwhitneyu
species = ['Chrysemys picta bellii','Chinchilla lanigera','Denticeps clupeoides','Calidris pygmaea','Macaca nemestrina','Notechis scutatus','Coturnix japonica','Junco hyemalis','Anas platyrhynchos platyrhynchos','Meleagris gallopavo','Eptatretus burgeri','Mus pahari','Mus caroli','Gadus morhua','Ciona savignyi','Anser brachyrhynchus','Piliocolobus tephrosceles','Ursus maritimus','Oryctolagus cuniculus','Latimeria chalumnae','Phascolarctos cinereus','Fundulus heteroclitus','Caenorhabditis elegans','Saccharomyces cerevisiae','Xenopus tropicalis','Mustela putorius furo','Periophthalmus magnuspinnatus','Callithrix jacchus','Tupaia belangeri','Tetraodon nigroviridis','Hippocampus comes','Salvator merianae','Nothoprocta perdicaria','Vombatus ursinus','Homo sapiens','Hucho hucho','Mastacembelus armatus','Cavia aperea','Procavia capensis','Ovis aries','Paramormyrops kingsleyae','Xiphophorus maculatus','Seriola lalandi dorsalis','Anolis carolinensis','Amphiprion ocellaris','Amphilophus citrinellus','Mus musculus','Panthera tigris altaica','Monodelphis domestica','Peromyscus maniculatus bairdii','Pongo abelii','Gorilla gorilla gorilla','Esox lucius','Cavia porcellus','Erpetoichthys calabaricus','Lates calcarifer','Ailuropoda melanoleuca','Taeniopygia guttata','Equus caballus','Oreochromis niloticus','Cebus capucinus imitator','Lepidothrix coronata','Mus spicilegus','Gouania willdenowi','Poecilia formosa','Oryzias melastigma','Meriones unguiculatus','Castor canadensis','Mandrillus leucophaeus','Maylandia zebra','Myotis lucifugus','Bison bison bison','Betta splendens','Apteryx rowi','Gallus gallus','Jaculus jaculus','Bos taurus','Nannospalax galili','Ochotona princeps','Pygocentrus nattereri','Bos mutus','Monopterus albus','Acanthochromis polyacanthus','Prolemur simus','Felis catus','Canis lupus familiaris','Poecilia latipinna','Neolamprologus brichardi','Microcebus murinus','Pelodiscus sinensis','Sorex araneus','Mus musculus castaneus','Mus musculus musculus','Pan troglodytes','Vulpes vulpes','Chlorocebus sabaeus','Macaca fascicularis','Gopherus agassizii','Cynoglossus semilaevis','Cyanistes caeruleus','Echinops telfairi','Propithecus coquereli','Danio rerio','Lepisosteus oculatus','Lonchura striata domestica','Mus musculus domesticus','Xiphophorus couchianus','Aotus nancymaae','Pan paniscus','Dipodomys ordii','Serinus canaria','Canis lupus dingo','Panthera pardus','Calidris pugnax','Parambassis ranga','Marmota marmota marmota','Urocitellus parryii','Spermophilus dauricus','Theropithecus gelada','Colobus angolensis palliatus','Ornithorhynchus anatinus','Poecilia mexicana','Mesocricetus auratus','Kryptolebias marmoratus','Loxodonta africana','Petromyzon marinus','Neovison vison','Larimichthys crocea','Callorhinchus milii','Chelonoidis abingdonii','Carlito syrichta','Seriola dumerili','Drosophila melanogaster','Rattus norvegicus','Scophthalmus maximus','Ursus americanus','Labrus bergylta','Pteropus vampyrus','Ictalurus punctatus','Pogona vitticeps','Anabas testudineus','Sus scrofa','Ficedula albicollis','Cricetulus griseus','Astatotilapia calliptera','Notamacropus eugenii','Dromaius novaehollandiae','Clupea harengus','Crocodylus porosus','Dasypus novemcinctus','Amphiprion percula','Sphenodon punctatus','Mus spretus','Bos indicus x Bos taurus','Microtus ochrogaster','Rhinopithecus bieti','Apteryx owenii','Melopsittacus undulatus','Choloepus hoffmanni','Cottoperca gobio','Octodon degus','Poecilia reticulata','Scleropages formosus','Erinaceus europaeus','Numida meleagris','Manacus vitellinus','Gasterosteus aculeatus','Zonotrichia albicollis','Rhinopithecus roxellana','Haplochromis burtoni','Astyanax mexicanus','Gambusia affinis','Capra hircus','Heterocephalus glaber','Stegastes partitus','Otolemur garnettii','Fukomys damarensis','Cercocebus atys','Cyprinodon variegatus','Ictidomys tridecemlineatus','Saimiri boliviensis boliviensis','Macaca mulatta','Oryzias latipes','Papio anubis','Ciona intestinalis','Nomascus leucogenys','Equus asinus asinus','Parus major','Mola mola','Electrophorus electricus','Tursiops truncatus','Apteryx haastii','Sarcophilus harrisii','Pundamilia nyererei','Vicugna pacos','Takifugu rubripes']
genes=read_csv('./human-genes-entropy-v6-expr-matched.csv').set_index('index')
DataFrame.from_records(
    ((sp,
     chisquare([((genes[sp]>0) * genes['cpgfull']).sum(), ((1-(genes[sp]>0)) * genes['cpgfull']).sum()], [(genes[sp]>0).sum()*genes['cpgfull'].sum()/len(genes), (1-(genes[sp]>0)).sum()*genes['cpgfull'].sum()/len(genes)]).pvalue*len(species),
     chisquare([((genes[sp]>0) * genes['hs_elife_overlaps']).sum(), ((1-(genes[sp]>0)) * genes['hs_elife_overlaps']).sum()], [(genes[sp]>0).sum()*genes['hs_elife_overlaps'].sum()/len(genes), (1-(genes[sp]>0)).sum()*genes['hs_elife_overlaps'].sum()/len(genes)]).pvalue*len(species)) for sp in species),
    columns = ['Species', '-300+100 50% CpG', 'eLife 1bp -1000+1000 CpG']).to_csv('ortho-chisq-sim-human-expr-matched.csv')
DataFrame.from_records(
    [('Mann-Whitney p-value', mannwhitneyu(((genes[species].T > 0).sum()/len(species))[genes['cpgfull']==0], ((genes[species].T > 0).sum()/len(species))[genes['cpgfull']==1], alternative='less'), mannwhitneyu(((genes[species].T > 0).sum()/len(species))[genes['hs_elife_overlaps']==0], ((genes[species].T > 0).sum()/len(species))[genes['hs_elife_overlaps']==1], alternative='less'))], columns=['Test',  '-300+100 50% CpG', 'eLife 1bp -1000+1000 CpG']).to_csv('ortho-mw-sim-human-expr-matched.csv')

#genes=read_csv('./mouse-genes.csv').set_index('index')
#DataFrame.from_records(
#    ((sp,
#     chisquare([((genes[sp]>0) * genes['cpgfull']).sum(), ((1-(genes[sp]>0)) * genes['cpgfull']).sum()], [(genes[sp]>0).sum()*genes['cpgfull'].sum()/len(genes), (1-(genes[sp]>0)).sum()*genes['cpgfull'].sum()/len(genes)]).pvalue*len(species),
#      chisquare([((genes[sp]>0) * genes['mm_elife_overlaps']).sum(), ((1-(genes[sp]>0)) * genes['mm_elife_overlaps']).sum()], [(genes[sp]>0).sum()*genes['mm_elife_overlaps'].sum()/len(genes), (1-(genes[sp]>0)).sum()*genes['mm_elife_overlaps'].sum()/len(genes)]).pvalue*len(species)) for sp in species),
#    columns = ['Species', '-300+100 50% CpG', 'eLife 1bp -1000+1000 CpG']).to_csv('ortho-chisq-sim-mouse.csv')
#DataFrame.from_records(
#    [('Mann-Whitney p-value', mannwhitneyu(((genes[species].T > 0).sum()/len(species))[genes['cpgfull']==0], ((genes[species].T > 0).sum()/len(species))[genes['cpgfull']==1], alternative='less'), mannwhitneyu(((genes[species].T > 0).sum()/len(species))[genes['mm_elife_overlaps']==0], ((genes[species].T > 0).sum()/len(species))[genes['mm_elife_overlaps']==1], alternative='less'))], columns=['Test',  '-300+100 50% CpG', 'eLife 1bp -1000+1000 CpG']).to_csv('ortho-mw-sim-mouse.csv')
